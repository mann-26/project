<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Snaplooks</title>
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css'>
    
    
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap");
        * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        }
    
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
    
        .dashboard {
            /* Your existing styles for the dashboard */
            height: 82vh;
            overflow-y: auto;
            padding: 20px;
            margin: 20px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-left: 16.5%;
            border-radius: 30px;
            scrollbar-width: thin;
            scrollbar-color: transparent transparent; /* Adjust the color as needed */
        }

        .dashboard::-webkit-scrollbar {
            width: 5px; /* Adjust the width as needed */
        }

        .dashboard::-webkit-scrollbar-thumb {
            background-color: transparent; /* Adjust the color as needed */
        }

        @media (max-width: 768px) {
            /* Add styles for responsiveness */
            .dashboard {
                margin-left: 0;
            }

            .left-section {
                width: 100%;
                float: none;
                margin-bottom: 20px;
            }
        }
    
        h2 {
            margin-bottom: 20px;
            color: #333;
        }
        h3{
            font-size: 20px;
        }
    
        .details {
            display: none;
        }
    
        .details p {
            color: #666;
            margin-bottom: 5px;
        }
    
        .details img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }
    
        .action-buttons {
            text-align: center;
            margin-top: 10px;
        }
    
        .action-buttons button {
            margin-bottom: 5px;
            margin-right: 10px;
            transition: background-color 0.3s ease-in-out;
        }
    
        .footer {
            background-color: #f9f9f9;
            color: #777;
            text-align: center;
            padding: 20px;
            margin-top: 20px;
        }
    
        /* Responsive Design */
    
        @media (max-width: 768px) {
            .dashboard {
                padding: 15px;
                margin: 15px;
            }
    
            .applications {
                padding: 15px;
                margin-bottom: 15px;
            }
    
            .action-buttons button {
                margin-right: 5px;
            }
        }

        .application-details img {
            max-width: 100%;
            max-height: 60px; /* Adjust the max-height as needed */
            margin-bottom: 10px;
            border-radius: 50%; /* Make the image round */
            object-fit: cover; /* Ensure the image covers the entire container */
        }

        header {
            background-color: #ffffff;
            color: #000000;
            padding: 10px;
            text-align: center;
            position: relative;
            z-index: 1; /* Ensure the header stays on top */
            height: 70px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .left-section {
            position: absolute;
            top: 0;
            left: 0;
            width: 15.5%;
            background-color: #000000;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            height: 100%; /* Adjust the height as needed */
            z-index: 2; /* Ensure the left section is above the header */
            font-family: "Poppins", sans-serif;
        }
        .navigation-link {
            cursor: pointer;
            color: #fff;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 15px;
            text-align: left;
            font-size: larger;
        }

        .navigation-link:hover {
            background-color: #333;

        }
        h4{
            color: white;
        }
        .salon-container {
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            cursor: pointer;
            border-radius: 30px;
        }
        h5{
            font-family: "Poppins", sans-serif;
            font-size: 30px;
            margin-left: 14%;
        }
        .navigation-link-logout-link{
            cursor: pointer;
            color: #fff;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 15px;
            background-color: #555;
            text-align: left;
            font-size: larger;
            /* margin-top: 200%; */
        }
        .navigation-link-logout-link:hover{
            background-color: #444;
        }
        .toggle-arrow {
            display: inline-block;
            margin-left: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .toggle-arrow.rotate-down {
            transform: rotate(180deg);
        }
        header{
            text-align: center;
            font-size: xx-large;
            margin-left: 10%;
            font-family: "Poppins", sans-serif;
        }
    </style>
    
</head>
<body>
    <header id="dashboardHeader">
    </header>
    <div class="left-section">
        <!-- Navigation links -->
        <h4 id="Title">Admin Dashboard</h4><br><br>
        <div class="navigation-link" onclick="showSalonData()">Salon</div>
        <div class="navigation-link" onclick="showFreelancerData()">Freelancer</div>
        <div class="navigation-link" onclick="showQuestionData()">Questions Asked</div>
        <div class="navigation-link" onclick="showQueryData()">Queries</div>


        <div class="navigation-link-logout-link" onclick="logout()">Logout</div>
    </div>
    <div class="dashboard">
        <div class="applications" id="salonList">
            <!-- Salon data will be displayed here -->
        </div>
        <div class="applications" id="freelancerList">
            <!-- Freelancer data will be displayed here -->
        </div>
        <div class="applications" id="questionList">
            <!-- Question data will be displayed here -->
        </div>
        <div class="applications" id="queryList">
            <!-- Query data will be displayed here -->
        </div>
    </div>

    <!-- Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore-compat.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBj1haaSvpv6SHe8PwX5wazT56DahPOKQQ",
            authDomain: "snaplooks-bd932.firebaseapp.com",
            databaseURL: "https://snaplooks-bd932-default-rtdb.firebaseio.com/",
            projectId: "snaplooks-bd932",
            storageBucket: "snaplooks-bd932.appspot.com",
            messagingSenderId: "680311673132",
            appId: "1:680311673132:web:5d55f0b0fe817b8ac39c89"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();


        // Function to hide both salon and freelancer data initially
        function hideAllData() {
            document.getElementById('questionList').style.display = 'none';
            document.getElementById('salonList').style.display = 'none';
            document.getElementById('freelancerList').style.display = 'none';
            document.getElementById('queryList').style.display = 'none';
        }


        function showSalonData() {
            hideAllData();
            document.getElementById('salonList').style.display = 'block';
            fetchSalonData();
            document.getElementById('dashboardHeader').innerText = "Salon Data";
        }

        function showFreelancerData() {
            hideAllData();
            document.getElementById('freelancerList').style.display = 'block';
            fetchFreelancerData();
            document.getElementById('dashboardHeader').innerText = "Freelancer Data";
        }

        function showQuestionData() {
            hideAllData();
            document.getElementById('questionList').style.display = 'block';
            fetchQuestionData();
            document.getElementById('dashboardHeader').innerText = "Questions Asked";
        }

        function showQueryData() {
            hideAllData();
            document.getElementById('queryList').style.display = 'block';
            fetchQueryData();
            document.getElementById('dashboardHeader').innerText = "User Queries";
        }

        function logout() {
            // Add your logout logic here, such as clearing authentication tokens or any other necessary steps.

            // For the sake of this example, let's redirect to the index.html file.
            window.location.href = 'index.html';
        }

        function fetchSalonData() {
            var salonList = document.getElementById('salonList');

            db.collection('salons').get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        salonList.innerHTML = '<p>No salon applications found.</p>';
                    } else {
                        salonList.innerHTML = ''; // Clear the existing content
                        querySnapshot.forEach((doc) => {
                            var salonData = doc.data();
                            console.log('Salon Data:', salonData); // Log all salon data for debugging

                            // Create a container for each salon
                            var salonContainer = document.createElement('div');
                            salonContainer.classList.add('salon-container');

                            salonContainer.innerHTML = `
                            <div class="application-details">
                                <img src="${salonData.salonDpImage}" alt="Salon DP">
                            </div>

                            <h3 onclick="toggleDetails(this)">${salonData.salonName}</h3>
                        <div class="details">
                            <p><strong>Owner's Name:</strong> ${salonData.ownerName}</p>
                            <p><strong>Location:</strong> ${salonData.areaName}</p>
                            <p><strong>Contact:</strong> ${salonData.contact}</p>
                            <p><strong>Open Time:</strong> ${salonData.openTime}</p>
                            <p><strong>Close Time:</strong> ${salonData.closeTime}</p>
                            <p><strong>Working Days:</strong> ${salonData.workingDays ? salonData.workingDays.join(', ') : 'N/A'}</p>
                            <p><strong>Services Provided By Salon:</strong></p>
                            <ul>
                            ${salonData.selectedServices ? salonData.selectedServices.map(service => `
                                <li style="margin-left: 40px;">
                                <strong>Name:</strong> ${service.name}<br>
                                <strong>Description:</strong> ${service.description}<br>
                                <strong>Price:</strong> ${service.price}<br>
                                <img src="${service.image}" alt="Service Image" style="max-width: 100%; height: 50px; margin-top: 10px; border-radius: 50px;">
                                </li>
                            `).join('') : '<li>N/A</li>'}
                            </ul>

                            <div class="actions-container">
                            <button class="btn btn-success approve-btn" onclick="approveSalon('${doc.id}')">Approve</button>
                            <button class="btn btn-danger decline-btn" onclick="declineSalon('${doc.id}')">Decline</button>
                        </div>

                        </div>
                            `;
                            function toggleButtonsVisibility(element) {
                                var buttonsContainer = element.nextElementSibling.querySelector('.actions-container');
                                if (buttonsContainer.style.display === 'block') {
                                    buttonsContainer.style.display = 'none';
                                } else {
                                    buttonsContainer.style.display = 'block';
                                }
                            }
                            

                            salonList.appendChild(salonContainer);
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error fetching salons: ", error);
                });
        }


        function fetchFreelancerData() {
            var freelancerList = document.getElementById('freelancerList');

            db.collection('freelancers').get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        freelancerList.innerHTML = '<p>No freelancer applications found.</p>';
                    } else {
                        freelancerList.innerHTML = ''; // Clear the existing content
                        querySnapshot.forEach((doc) => {
                            var freelancerData = doc.data();
                            var freelancerEntry = document.createElement('div');
                            freelancerEntry.classList.add('salon-container');
                            freelancerEntry.innerHTML = `
                                <h3 onclick="toggleDetails(this)">${freelancerData.freelancerName}</h3>
                                <div class="details">
                                    <img src="${freelancerData.freelancerDpImage}" alt="Freelancer DP">
                                    <p><strong>Freelancer's Name:</strong> ${freelancerData.freelancerName}</p>
                                    <p><strong>Location:</strong> ${freelancerData.location}</p>
                                    <p><strong>Contact:</strong> ${freelancerData.contact}</p>
                                    <!-- Add other details as needed -->
                                </div>
                            `;

                            // Create approve and decline buttons for each freelancer
                            var actionButtons = document.createElement('div');
                            actionButtons.classList.add('action-buttons');
                            actionButtons.innerHTML = `
                                <button class="btn btn-success approve-btn" onclick="approveFreelancer('${doc.id}')">Approve</button>
                                <button class="btn btn-danger decline-btn" onclick="declineFreelancer('${doc.id}')">Decline</button>
                            `;
                            freelancerEntry.appendChild(actionButtons);

                            freelancerList.appendChild(freelancerEntry);
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error fetching freelancers: ", error);
                });
        }

        function fetchQuestionData() {
            var questionList = document.getElementById('questionList');

            db.collection('question_asked').get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        questionList.innerHTML = '<p>No questions found.</p>';
                    } else {
                        questionList.innerHTML = ''; // Clear the existing content

                        // Counter for numbering questions
                        let questionCounter = 1;

                        querySnapshot.forEach((doc) => {
                            var questionData = doc.data();
                            var questionEntry = document.createElement('div');
                            questionEntry.classList.add('application');
                            questionEntry.innerHTML = `
                                <h3>${questionCounter}. ${questionData.question}</h3>
                                <!-- Add other details as needed -->
                            `;

                            questionList.appendChild(questionEntry);

                            // Increment the question counter
                            questionCounter++;
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error fetching questions: ", error);
                });
        }

        function fetchQueryData() {
            var queryList = document.getElementById('queryList');

            db.collection('user_queries').get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        queryList.innerHTML = '<p>No user queries found.</p>';
                    } else {
                        queryList.innerHTML = ''; // Clear the existing content
                        querySnapshot.forEach((doc) => {
                            var queryData = doc.data();
                            var queryEntry = document.createElement('div');
                            queryEntry.classList.add('application');
                            queryEntry.innerHTML = `
                                <h3 onclick="toggleDetails(this)"><br>
                                    ${queryData.userName}'s Query
                                    <span class="toggle-arrow">&#9660;</span>
                                </h3>
                                <div class="details" style="display: none;">
                                    <p><strong>Email:</strong> ${queryData.userEmail}</p>
                                    <p><strong>Query:</strong> ${queryData.userQuery}</p>
                                    <p><strong>Timestamp:</strong> ${queryData.timestamp ? new Date(queryData.timestamp.toMillis()).toLocaleString() : 'N/A'}</p>
                                    <!-- Add other details as needed -->
                                </div>
                            `;

                            queryList.appendChild(queryEntry);
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error fetching user queries: ", error);
                });
        }



        // Toggle details visibility
        function toggleDetails(element) {
            var details = element.nextElementSibling;
            var arrow = element.querySelector('.toggle-arrow');

            if (details.style.display === 'block') {
                details.style.display = 'none';
                arrow.classList.remove('rotate-down');
            } else {
                details.style.display = 'block';
                arrow.classList.add('rotate-down');
            }
        }

        hideAllData();
        fetchSalonData();
        fetchFreelancerData();
        fetchQuestionData();


        // Function to handle approving a salon
        function approveSalon(salonId) {
            const confirmation = window.confirm('Are you sure you want to approve this salon application?');
            if (!confirmation) {
                return; // If the user cancels, exit the function
            }

            const salonRef = db.collection('salons').doc(salonId);
            salonRef.get()
                .then((doc) => {
                    if (doc.exists) {
                        const salonData = doc.data();

                        // Add the approved salon to the "approved" collection with the same ID
                        db.collection('approved').doc(salonId).set(salonData)
                            .then(() => {
                                console.log('Salon approved and added to "approved" collection');

                                // Remove the salon from the "salons" collection after approval
                                salonRef.delete()
                                    .then(() => {
                                        console.log('Salon removed from "salons" collection');

                                        // Update the UI or fetch salon data again to reflect changes
                                        fetchSalonData();
                                    })
                                    .catch((error) => {
                                        console.error('Error removing salon:', error);
                                    });
                            })
                            .catch((error) => {
                                console.error('Error adding salon to "approved" collection:', error);
                            });
                    } else {
                        console.log('No such salon document!');
                    }
                })
                .catch((error) => {
                    console.error('Error getting salon document:', error);
                });
        }

        // Function to handle declining a salon
        function declineSalon(salonId) {
            const confirmation = window.confirm('Are you sure you want to decline this salon application?');
            if (!confirmation) {
                return; // If the user cancels, exit the function
            }

            const salonRef = db.collection('salons').doc(salonId);
            salonRef.get()
                .then((doc) => {
                    if (doc.exists) {
                        const salonData = doc.data();

                        // Add the declined salon to the "declined" collection with the same ID
                        db.collection('declined').doc(salonId).set(salonData)
                            .then(() => {
                                console.log('Salon declined and added to "declined" collection');

                                // Remove the salon from the "salons" collection after decline
                                salonRef.delete()
                                    .then(() => {
                                        console.log('Salon removed from "salons" collection');

                                        // Update the UI or fetch salon data again to reflect changes
                                        fetchSalonData();
                                    })
                                    .catch((error) => {
                                        console.error('Error removing salon:', error);
                                    });
                            })
                            .catch((error) => {
                                console.error('Error adding salon to "declined" collection:', error);
                            });
                    } else {
                        console.log('No such salon document!');
                    }
                })
                .catch((error) => {
                    console.error('Error getting salon document:', error);
                });
        }

        function approveFreelancer(freelancerId) {
    const confirmation = window.confirm('Are you sure you want to approve this freelancer application?');
    if (!confirmation) {
        return; // If the user cancels, exit the function
    }

    const freelancerRef = db.collection('freelancers').doc(freelancerId);
    freelancerRef.get()
        .then((doc) => {
            if (doc.exists) {
                const freelancerData = doc.data();

                // Add the approved freelancer to the "approved_freelancers" collection with the same ID
                db.collection('approved_freelancers').doc(freelancerId).set(freelancerData)
                    .then(() => {
                        console.log('Freelancer approved and added to "approved_freelancers" collection');

                        // Remove the freelancer from the "freelancers" collection after approval
                        freelancerRef.delete()
                            .then(() => {
                                console.log('Freelancer removed from "freelancers" collection');

                                // Update the UI or fetch freelancer data again to reflect changes
                                fetchFreelancerData();
                            })
                            .catch((error) => {
                                console.error('Error removing freelancer:', error);
                            });
                    })
                    .catch((error) => {
                        console.error('Error adding freelancer to "approved_freelancers" collection:', error);
                    });
            } else {
                console.log('No such freelancer document!');
            }
        })
        .catch((error) => {
            console.error('Error getting freelancer document:', error);
        });
}


function declineFreelancer(freelancerId) {
    const confirmation = window.confirm('Are you sure you want to decline this freelancer application?');
    if (!confirmation) {
        return; // If the user cancels, exit the function
    }

    const freelancerRef = db.collection('freelancers').doc(freelancerId);
    freelancerRef.get()
        .then((doc) => {
            if (doc.exists) {
                const freelancerData = doc.data();

                // Add the declined freelancer to the "declined_freelancers" collection with the same ID
                db.collection('declined_freelancers').doc(freelancerId).set(freelancerData)
                    .then(() => {
                        console.log('Freelancer declined and added to "declined_freelancers" collection');

                        // Remove the freelancer from the "freelancers" collection after decline
                        freelancerRef.delete()
                            .then(() => {
                                console.log('Freelancer removed from "freelancers" collection');

                                // Update the UI or fetch freelancer data again to reflect changes
                                fetchFreelancerData();
                            })
                            .catch((error) => {
                                console.error('Error removing freelancer:', error);
                            });
                    })
                    .catch((error) => {
                        console.error('Error adding freelancer to "declined_freelancers" collection:', error);
                    });
            } else {
                console.log('No such freelancer document!');
            }
        })
        .catch((error) => {
            console.error('Error getting freelancer document:', error);
        });
}

    </script>
</body>
</html>
