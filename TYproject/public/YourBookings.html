<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard</title>
    <!-- Include Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="/assets/YourBookings.css">
</head>

<body>
    <div id="customerDashboard">
        <h1>Your Bookings</h1>
        <div id="bookingStatus"></div>

    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBj1haaSvpv6SHe8PwX5wazT56DahPOKQQ",
            authDomain: "snaplooks-bd932.firebaseapp.com",
            databaseURL: "https://snaplooks-bd932-default-rtdb.firebaseio.com/",
            projectId: "snaplooks-bd932",
            storageBucket: "snaplooks-bd932.appspot.com",
            messagingSenderId: "680311673132",
            appId: "1:680311673132:web:5d55f0b0fe817b8ac39c89"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();

        // Check user authentication state
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                displayBookingStatus(user.uid);
            } else {
                // // User is signed out
                // console.log('User is signed out.');
                // window.location.href = 'index.html'; // Redirect to login page
            }
        });

        // Function to display booking status
        async function displayBookingStatus(userId) {
            // Reference to the "Salon_bookings" collection
            var salonBookingsRef = db.collection('Salon_bookings').where('userId', '==', userId);

            // Reference to the "Approved_bookings" collection
            var approvedBookingsRef = db.collection('Approved_bookings').where('userId', '==', userId);

            // Reference to the "Booking_Completed" collection
            var completedBookingsRef = db.collection('Booking_Completed').where('userId', '==', userId);

            // Reference to the "Declined_bookings" collection
            var declinedBookingsRef = db.collection('Declined_bookings').where('userId', '==', userId);

            // Fetch bookings from each collection
            var hasBookings = false;

            await salonBookingsRef.get().then(querySnapshot => {
                if (!querySnapshot.empty) {
                    // Display "Pending" bookings
                    document.getElementById('bookingStatus').innerHTML += '<p>Pending Bookings:</p>';
                    querySnapshot.forEach(doc => {
                        displayBookingInfo(doc);
                    });
                    hasBookings = true;
                }
            });

            await approvedBookingsRef.get().then(querySnapshot => {
                if (!querySnapshot.empty) {
                    // Display "Approved" bookings
                    document.getElementById('bookingStatus').innerHTML += '<p>Approved Bookings:</p>';
                    querySnapshot.forEach(doc => {
                        displayBookingInfo(doc);
                    });
                    hasBookings = true;
                }
            });

            await completedBookingsRef.get().then(querySnapshot => {
                if (!querySnapshot.empty) {
                    // Display "Complete" bookings
                    document.getElementById('bookingStatus').innerHTML += '<p>Completed Bookings:</p>';
                    querySnapshot.forEach(doc => {
                        displayBookingInfo(doc);
                    });
                    hasBookings = true;
                }
            });

            await declinedBookingsRef.get().then(querySnapshot => {
                if (!querySnapshot.empty) {
                    // Display "Declined" bookings
                    document.getElementById('bookingStatus').innerHTML += '<p>Declined Bookings:</p>';
                    querySnapshot.forEach(doc => {
                        displayBookingInfo(doc);
                    });
                    hasBookings = true;
                }
            });

            // Display "No Bookings" if there are no bookings
            if (!hasBookings) {
                document.getElementById('bookingStatus').innerHTML += '<p>No Bookings</p>';
            }
        }

        // Function to display booking information
        async function displayBookingInfo(doc) {
            var bookingData = doc.data();
            // Fetch salon name and profile picture based on salonId
            var salonId = bookingData.salonId;
            var salonData = await getSalonData(salonId);

            var bookingHtml = `
                <div class="booking-entry">
                    <p>Salon: ${salonData.salonName}</p>
                    <img src="${salonData.salonDpImage}" alt="Salon Profile Picture">
                    <p>Date: ${bookingData.appointmentDate}</p>
                    <p>Time: ${bookingData.appointmentTime}</p>
                    <p>Services: ${bookingData.selectedServices}</p>
                    <p>Total Amount: ${bookingData.totalAmount}</p>
                    <p>Status: ${getStatusLabel(doc.ref.parent.id)}</p>
                </div>
            `;
            document.getElementById('bookingStatus').innerHTML += bookingHtml;
        }

        function getSalonData(salonId) {
            // Fetch salon data from the "Salons" collection
            var salonRef = db.collection('approved').doc(salonId);
            return salonRef.get().then(salonDoc => {
                if (salonDoc.exists) {
                    return salonDoc.data();
                } else {
                    return { salonName: 'Unknown Salon', profilePicture: '' };
                }
            }).catch(error => {
                console.error('Error fetching salon data:', error);
                return { salonName: 'Unknown Salon', profilePicture: '' };
            });
        }

        // Function to get the status label based on the collection name
        function getStatusLabel(collectionName) {
            switch (collectionName) {
                case 'Salon_bookings':
                    return 'Pending';
                case 'Approved_bookings':
                    return 'Approved';
                case 'Booking_Completed':
                    return 'Completed';
                case 'Declined_bookings':
                    return 'Declined';
                default:
                    return 'Unknown';
            }
        }

        // // Function to handle logout
        // function logout() {
        //     firebase.auth().signOut().then(() => {
        //         console.log('User signed out.');
        //     }).catch(error => {
        //         console.error('Error signing out:', error);
        //     });
        // }
    </script>
</body>

</html>
